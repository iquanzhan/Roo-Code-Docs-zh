---
description: 了解 Roo Code 的令牌使用、成本计算和优化策略。学习如何有效管理 API 成本和设置请求限制。
keywords:
  - 速率限制
  - API 成本
  - 令牌使用
  - 成本优化
  - 自动批准限制
  - API 管理
image: /img/social-share.jpg
---

# 速率限制和成本

理解和管理 API 使用对于在 Roo Code 中获得流畅且具有成本效益的体验至关重要。本节解释了如何跟踪你的令牌使用和成本。速率限制默认为 0（禁用），通常不需要调整，现在按配置文件进行配置；如果需要，请参阅 [API 配置文件](/features/api-configuration-profiles#creating-a-profile) 文档了解如何设置它们。

---

## 令牌使用

Roo Code 使用令牌与 AI 模型进行交互。令牌本质上是单词的片段。请求和响应中使用的令牌数量会影响处理时间和成本。

*   **输入令牌：** 这些是你提示中的令牌，包括系统提示、你的指令和提供的任何上下文（例如，文件内容）。
*   **输出令牌：** 这些是 AI 模型在其响应中生成的令牌。

你可以在聊天历史记录中看到每次交互使用的输入和输出令牌数量。

---

## 成本计算

大多数 AI 提供商根据使用的令牌数量收费。定价根据提供商和特定模型而有所不同。

Roo Code 会根据配置模型的定价自动计算每次 API 请求的估计成本。此成本显示在聊天历史记录中，紧挨着令牌使用情况。

**注意：**

*   成本计算是一个 *估计值*。实际成本可能会因提供商的计费实践而略有不同。
*   一些提供商可能提供免费层级或信用额度。请查看你的提供商文档了解详细信息。
*   一些提供商提供提示缓存，这可以大大降低成本。

### 限制自动批准的请求

为了进一步帮助管理 API 成本并防止意外支出，Roo Code 包含了一个用于自动批准操作的“最大请求数”设置。这允许你定义 Roo Code 在任务期间无需你明确重新批准即可进行的连续 API 调用的特定限制。

*   **工作原理：** 如果你设置了限制（例如，5 个请求），Roo Code 将执行最多 5 个自动批准的 API 调用。在进行第 6 次调用之前，它会暂停并提示你“重置并继续”，如下所示。
    <img src="/img/v3.18.0/v3.18.0-1.png" alt="警告消息，表示已达到自动批准的请求限制。" width="600" />
    *达到自动批准请求限制时的通知。*
*   **配置：** 此限制在“自动批准操作”设置中配置。你可以设置一个特定的数字或选择“无限制”。有关配置此设置和其他自动批准设置的详细步骤，请参见 [自动批准操作文档](/features/auto-approving-actions)。
    <img src="/img/v3.18.0/v3.18.0.png" alt="在 Roo Code 设置中为自动批准操作设置最大请求数限制。" width="600" />
    *为自动批准操作设置“最大请求数”。*

此功能提供了额外的保障，特别是对于可能涉及多个 API 调用的复杂或长时间运行的任务。

---

## 优化令牌使用的提示

*   **简洁明了：** 在提示中使用清晰简洁的语言。避免不必要的词语或细节。
*   **仅提供相关上下文：** 有选择地使用上下文提及（`@file.ts`, `@folder/`）。仅包括与任务直接相关的文件。
*   **分解任务：** 将大型任务分解为更小、更集中的子任务。
*   **使用自定义指令：** 提供自定义指令以指导 Roo Code 的行为，并减少在每个提示中进行冗长解释的需要。
*   **选择合适的模型：** 一些模型比其他模型更具成本效益。考虑对不需要大型模型全部功能的任务使用较小、较快的模型。
*   **使用模式：** 不同的模式可以访问不同的工具，例如 `Architect` 无法修改代码，这使得它成为分析复杂代码库时的安全选择，而无需担心意外允许昂贵的操作。
*   **如果不使用 MCP 则禁用：** 如果你没有使用 MCP（模型上下文协议）功能，请考虑 [在 MCP 设置中禁用它](/features/mcp/using-mcp-in-roo#enabling-or-disabling-mcp-server-creation) 以显著减少系统提示的大小并节省令牌。

通过理解和管理你的 API 使用，你可以有效地使用 Roo Code。