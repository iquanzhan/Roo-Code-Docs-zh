---
description: 了解 new_task 工具如何通过创建具有不同模式的子任务来实现复杂的工作流管理，保持父子关系以实现有序开发。
keywords:
  - new_task
  - Roo Code 工具
  - 子任务
  - 工作流管理
  - 任务层次结构
  - 模式切换
  - 复杂项目
  - 任务组织
  - VS Code AI
image: /img/social-share.jpg
---

# 新任务

`new_task` 工具创建具有专门模式的子任务，同时保持父子关系。它将复杂项目分解为可管理的部分，每个部分在最适合特定工作的模式下运行。

---

## 参数

该工具接受以下参数：

- `mode` (必需): 启动新任务的模式 slug (例如, "code", "ask", "architect")
- `message` (必需): 此新任务的初始用户消息或指令

---

## 功能

此工具创建具有指定起始模式和初始消息的新任务实例。它允许将复杂的工作流划分为具有自己对话历史的子任务。在子任务执行期间，父任务会暂停，并在子任务完成时恢复，结果会传回给父任务。

---

## 使用场景

- 当需要将复杂项目分解为独立的、专注的子任务时
- 当任务的不同方面需要不同的专门模式时
- 当工作的不同阶段受益于上下文分离时
- 当组织多阶段开发工作流时

---

## 主要特性

- 创建具有自己对话历史和专门模式的子任务
- 暂停父任务以便稍后恢复
- 维护分层任务关系以便导航
- 完成后将结果传回父任务
- 支持复杂项目的工 workflow 隔离
- 允许项目不同部分使用针对特定工作优化的模式
- 需要用户明确批准任务创建
- 在 UI 中提供清晰的任务转换

---

## 限制

- 无法创建不存在模式的任务
- 创建每个新任务前需要用户批准
- 任务界面在深度嵌套的子任务中可能变得复杂
- 子任务从父任务继承某些工作区和扩展配置
- 在深度嵌套任务之间切换时可能需要重新建立上下文
- 任务完成需要明确信号才能正确返回父任务

---

## 工作原理

当调用 `new_task` 工具时，它遵循以下过程：

1. **参数验证**:
   - 验证必需的 `mode` 和 `message` 参数
   - 验证请求的模式在系统中是否存在

2. **任务栈管理**:
   - 维护跟踪所有活动和暂停任务的任务栈
   - 保留当前模式以便稍后恢复
   - 将父任务设置为暂停状态

3. **任务上下文管理**:
   - 使用提供的消息创建新任务上下文
   - 分配唯一的 taskId 和 instanceId 标识符用于状态管理
   - 捕获工具使用和任务生命周期的遥测数据

4. **模式切换和集成**:
   - 切换到指定模式并具备适当的角色和功能
   - 使用提供的消息初始化新任务
   - 与 VS Code 的命令面板和代码操作集成

5. **任务完成和结果传输**:
   - 当子任务完成时，结果通过 `finishSubTask()` 传回父任务
   - 父任务在其原始模式下恢复
   - 更新任务历史和令牌使用指标
   - 发出带有性能数据的 `taskCompleted` 事件

---

## 使用示例

- 当前端开发人员需要设计新功能、实现代码和编写文档时，他们可以为每个阶段创建单独的任务，结果从一个阶段流向下一个阶段。
- 在实现修复之前调试问题时，调试任务可以记录发现并传递给实现任务。
- 在开发全栈应用程序时，架构师模式任务中的数据库模式设计会通知后续代码模式任务中的实现细节。
- 在实现后记录系统文档时，文档任务可以在使用文档特定功能的同时引用已完成的实现。

---

## 使用示例

在代码模式下创建新任务：
```
<new_task>
<mode>code</mode>
<message>实现具有登录、注册和密码重置功能的用户认证服务。</message>
</new_task>
```

在完成实现后创建文档任务：
```
<new_task>
<mode>docs</mode>
<message>为我们刚刚构建的认证服务创建全面的 API 文档。</message>
</new_task>
```

将复杂功能分解为架构规划和实现：
```
<new_task>
<mode>architect</mode>
<message>为我们的新电子商务平台设计数据库模式和系统架构。</message>
</new_task>
```
