---
description: 了解如何在 Roo Code 中使用自定义指令来个性化 AI 助手的行为，包括全局规则、工作区规则和模式特定指令的配置方法。
keywords:
  - 自定义指令
  - AI 个性化
  - 全局规则
  - 工作区规则
image: /img/social-share.jpg
---

# 自定义指令

自定义指令允许您通过提供特定于项目或团队的规则、偏好和上下文来影响 Roo Code 的行为。这使 Roo 能够更好地适应您的工作流程、编码标准和项目要求。

有两种主要类型的自定义指令：

1. **全局指令**：适用于所有项目和工作区
2. **工作区级指令**：仅适用于当前工作区

## 全局指令

全局指令适用于所有项目和工作区，使您能够在所有 Roo Code 交互中保持一致的行为。

### 全局指令文件位置

全局规则目录位置是固定的，无法自定义：

**Linux/macOS:**
```
~/.roo/                           # 您的全局 Roo 配置
├── rules/                        # 应用于所有项目的通用规则
│   ├── coding-standards.md
│   ├── formatting-rules.md
│   └── security-guidelines.md
├── rules-code/                   # 代码模式的特定规则
│   ├── typescript-rules.md
│   └── testing-requirements.md
├── rules-docs-extractor/         # 文档提取的规则
│   └── documentation-style.md
└── rules-{mode}/                 # 其他特定模式的规则
    └── mode-specific-rules.md
```

**Windows:**
```
%USERPROFILE%\.roo\               # 您的全局 Roo 配置
├── rules\                        # 应用于所有项目的通用规则
│   ├── coding-standards.md
│   ├── formatting-rules.md
│   └── security-guidelines.md
├── rules-code\                   # 代码模式的特定规则
│   ├── typescript-rules.md
│   └── testing-requirements.md
└── rules-{mode}\                 # 其他特定模式的规则
    └── mode-specific-rules.md
```

#### 设置全局规则

1. **创建全局规则目录:**
   ```bash
   # Linux/macOS
   mkdir -p ~/.roo/rules
   
   # Windows
   mkdir %USERPROFILE%\.roo\rules
   ```

2. **添加通用规则** (`~/.roo/rules/coding-standards.md`):
   ```markdown
   # 全局编码标准
   
   1. 始终为新项目使用 TypeScript
   2. 为所有新函数编写单元测试
   3. 使用描述性变量名
   4. 为公共 API 添加 JSDoc 注释
   ```

3. **添加模式特定规则** (`~/.roo/rules-code/typescript-rules.md`):
   ```markdown
   # TypeScript 代码模式规则
   
   1. 在 tsconfig.json 中使用严格模式
   2. 对于对象形状，优先使用接口而不是类型别名
   3. 始终为函数指定返回类型
   ```

#### 可用的规则目录

| 目录 | 目的 |
|-----------|---------|
| `rules/` | 应用于所有模式的通用规则 |
| `rules-code/` | 代码模式的特定规则 |
| `rules-docs-extractor/` | 文档提取的规则 |
| `rules-architect/` | 系统架构任务的规则 |
| `rules-debug/` | 调试工作流的规则 |
| `rules-{mode}/` | 任何自定义模式的规则 |

#### 规则加载顺序

规则按以下顺序加载：

1. **全局规则** (来自 `~/.roo/`)
2. **项目规则** (来自 `project/.roo/`) - 可以覆盖全局规则
3. **遗留文件** (`.roorules`, `.clinerules` - 为了向后兼容)

在每个级别内，模式特定规则在通用规则之前加载。

### 工作区级指令

这些指令仅适用于您当前的工作区，允许您为特定项目自定义 Roo Code 的行为。

#### 通过文件/目录进行工作区范围的指令

工作区范围的指令适用于当前项目中的所有模式，可以通过文件定义：

*   **首选方法：基于目录 (`.roo/rules/`) **
    *   在您的工作区根目录中创建一个名为 `.roo/rules/` 的目录。
    *   在其中放置指令文件（例如 `.md`, `.txt`）。Roo Code 会递归读取文件，并根据文件名按**字母顺序**将它们的内容附加到系统提示中。
    *   如果目录存在且包含文件，则此方法优先。
*   **备用方法：基于文件 (`.roorules`) **
    *   如果 `.roo/rules/` 不存在或为空，Roo Code 会查找工作区根目录中的单个 `.roorules` 文件。
    *   如果找到，则加载其内容。

#### 模式特定指令

模式特定指令可以通过两种独立的方式设置，可以同时使用：

1.  **使用提示选项卡:**

    <img src="/img/custom-instructions/custom-instructions-2.png" alt="Roo Code 提示选项卡显示模式特定自定义指令界面" width="600" />
    * **打开选项卡:** 点击 Roo Code 顶部菜单栏中的 <Codicon name="notebook" /> 图标
    * **选择模式:** 在模式标题下，点击您想要自定义的模式按钮
    * **输入指令:** 在"模式特定自定义指令（可选）"下的文本区域中输入您的指令
    * **保存更改:** 点击"完成"保存您的更改

        :::info 全局模式规则
        如果模式本身是全局的（不是工作区特定的），您为其设置的任何自定义指令也将全局应用于该模式的所有工作区。
        :::

2.  **使用规则文件/目录:** 通过文件提供模式特定指令：
    *   **首选方法：基于目录 (`.roo/rules-{modeSlug}/`) **
        *   在您的工作区根目录中创建一个名为 `.roo/rules-{modeSlug}/` 的目录（例如 `.roo/rules-docs-writer/`）。
        *   在其中放置指令文件（递归加载）。文件按文件名字母顺序读取并附加到系统提示中。
        *   如果目录存在且包含文件，则此方法优先于特定模式的备用文件方法。
    *   **备用方法：基于文件 (`.roorules-{modeSlug}`) **
        *   如果 `.roo/rules-{modeSlug}/` 不存在或为空，Roo Code 会查找工作区根目录中的单个 `.roorules-{modeSlug}` 文件（例如 `.roorules-code`）。
        *   如果找到，则为该模式加载其内容。

提示选项卡、全局规则、工作区规则和模式特定规则的指令都会组合在一起。请参阅下面的部分了解确切的顺序。

---

## 指令如何组合

指令按以下确切格式放置在系统提示中：

```
====
用户的自定义指令

以下附加指令由用户提供，应在不干扰工具使用指南的情况下尽可能遵循。

[语言偏好（如果已设置）]

[全局指令（来自提示选项卡）]

[模式特定指令（来自当前模式的提示选项卡）]

全局规则（来自 ~/.roo/）：
[~/.roo/rules-{modeSlug}/ 中文件的内容（如果目录存在且不为空）]
[~/.roo/rules/ 中文件的内容（如果目录存在且不为空）]

模式特定指令（来自文件/目录）：
[.roo/rules-{modeSlug}/ 中文件的内容（如果目录存在且不为空）]
[.roorules-{modeSlug} 文件的内容（如果 .roo/rules-{modeSlug}/ 不存在或为空，且文件存在）]

工作区范围指令（来自文件/目录）：
[.roo/rules/ 中文件的内容（如果目录存在且不为空）]
[.roorules 文件的内容（如果 .roo/rules/ 不存在或为空，且文件存在）]

====
```

*注意：全局规则首先加载，然后是可覆盖它们的工作区规则。在每个级别内，模式特定规则出现在通用规则之前，基于目录的规则优先于基于文件的备用规则。*

---

## 关于 .rules 文件的规则

* **文件位置：** 首选方法在 `.roo/` 内使用目录（`.roo/rules/` 和 `.roo/rules-{modeSlug}/`）。备用方法使用位于工作区根目录中的单个文件（`.roorules` 和 `.roorules-{modeSlug}`）。
* **空文件：** 空文件或缺失的规则文件会被静默跳过
* **源标头：** 每个规则文件的内容都包含一个指示其来源的标头
* **规则交互：** 模式特定规则补充全局规则而不是替换它们

---

## 自定义指令示例

* "始终使用空格进行缩进，宽度为 4 个空格"
* "使用驼峰命名法命名变量"
* "为所有新函数编写单元测试"
* "在提供代码之前解释您的推理"
* "专注于代码的可读性和可维护性"
* "优先使用社区中最常见的库"
* "在向网站添加新功能时，确保它们具有响应性和可访问性"

:::tip 专业提示：团队标准化
对于团队环境，请考虑以下方法：

**项目标准**：在版本控制下使用工作区 `.roo/rules/` 目录，为特定项目标准化 Roo 的行为。这确保了团队成员之间一致的代码风格和开发工作流。

**组织标准**：使用全局规则（`~/.roo/rules/`）建立适用于所有项目的组织范围编码标准。团队成员可以设置相同的全局规则，以确保所有工作的一致性。

**混合方法**：将全局规则用于组织标准，将项目特定的工作区规则用于项目特定的要求。工作区规则可以在需要时覆盖全局规则。

基于目录的方法比单个 `.roorules` 文件提供了更好的组织，并支持全局和项目级别的自定义。
:::

---

## 与自定义模式结合

对于高级自定义，请结合[自定义模式](/features/custom-modes)创建具有特定工具访问权限、文件限制和量身定制指令的专用环境。
