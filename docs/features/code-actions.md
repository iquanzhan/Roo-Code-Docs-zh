---
description: 通过代码操作功能，直接在编辑器中访问 Roo Code 的 AI 助手。通过 VSCode 的灯泡系统获得即时修复、解释和改进。
keywords:
  - 代码操作
  - 快速修复
  - 灯泡菜单
  - AI 助手
  - VSCode 集成
  - 代码改进
  - 错误修复
image: /img/social-share.jpg
---

# 代码操作

代码操作功能通过 VSCode 的灯泡（快速修复）系统，让您直接在代码编辑器中即时访问 Roo Code 的 AI 助手。这一上下文感知功能会自动检测相关的代码情况，并提供适当的 AI 驱动操作，而无需您切换到聊天界面。

---

## 什么是代码操作？

代码操作在编辑器装订线（行号左侧区域）中显示为灯泡图标（💡）。也可以通过右键单击上下文菜单或键盘快捷键访问。它们在以下情况下触发：

*   您选择了一段代码。
*   您的光标位于有问题的行上（错误、警告或提示）。
*   您通过命令调用它们。

单击灯泡图标、右键单击并选择“Roo Code”，或使用键盘快捷键（默认为 `Ctrl+.` 或 macOS 上的 `Cmd+.`），将显示可用操作的菜单。

---

## Roo Code 的代码操作

Roo Code 提供 5 种代码操作，但它们的可用性因上下文而异：

### 上下文菜单操作（右键单击）
*   **添加到上下文：** 快速将选定的代码添加到与 Roo 的聊天中，包括文件名和行号，以便 Roo 确切知道代码来源。它在菜单中列在首位，便于访问。
*   **解释代码：** 要求 Roo Code 解释选定的代码。
*   **改进代码：** 要求 Roo Code 为选定的代码提出改进建议。

### 其他操作
*   **修复代码：** 通过灯泡菜单和命令面板提供（但不在右键菜单中）。要求 Roo Code 修复选定代码中的问题。
*   **新建任务：** 使用选定的代码创建新任务。通过命令面板提供。

### 上下文感知操作
灯泡菜单会根据您的代码当前状态智能地显示不同的操作：

**对于有问题的代码**（当 VSCode 显示红色/黄色波浪线时）：
- **修复代码** - 获得逐步指导以解决特定的错误或警告
- **添加到上下文** - 将有问题的代码添加到 Roo 的上下文中进行讨论

**对于干净的代码**（无诊断信息）：
- **解释代码** - 获取代码功能的详细解释
- **改进代码** - 接收优化建议和最佳实践
- **添加到上下文** - 将代码添加到 Roo 的上下文中进行进一步工作

有关诊断如何与代码操作集成的更多详细信息，请参见[诊断集成](/features/diagnostics-integration)。

### 深入了解“添加到上下文”

**添加到上下文**操作在代码操作菜单中列在首位，因此您可以快速将代码片段添加到对话中。当您使用它时，Roo Code 会包含文件名和行号以及代码。

这有助于 Roo 理解您的代码在项目中的确切上下文，从而提供更相关和准确的帮助。

**聊天输入示例：**

```
你能解释一下这个函数吗？
@myFile.js:15:25
```

*（其中 `@myFile.js:15:25` 表示通过“添加到上下文”添加的代码）*

---

## 使用代码操作

有三种主要方式使用 Roo Code 的代码操作：

### 1. 从灯泡图标（💡）

1.  **选择代码：** 选择您要处理的代码。您可以选择单行、多行或整个代码块。
2.  **寻找灯泡图标：** 在选定代码（或有错误/警告的行）旁边的装订线中将出现一个灯泡图标。
3.  **单击灯泡图标：** 单击灯泡图标以打开代码操作菜单。
4.  **选择操作：** 从菜单中选择所需的 Roo Code 操作。
5.  **查看和批准：** Roo Code 将在聊天面板中提出解决方案。查看提议的更改并批准或拒绝它们。

### 2. 从右键单击上下文菜单

1.  **选择代码：** 选择您要处理的代码。
2.  **右键单击：** 右键单击选定的代码以打开上下文菜单。
3.  **选择“Roo Code”：** 从上下文菜单中选择“Roo Code”选项。将出现一个子菜单，其中包含可用的 Roo Code 操作。
4.  **选择操作：** 从子菜单中选择所需的操作。
5.  **查看和批准：** Roo Code 将在聊天面板中提出解决方案。查看提议的更改并批准或拒绝它们。

### 3. 从命令面板

1.  **选择代码：** 选择您要处理的代码。
2.  **打开命令面板：** 按 `Ctrl+Shift+P`（Windows/Linux）或 `Cmd+Shift+P`（macOS）。
3.  **输入命令：** 输入“Roo Code”以筛选命令，然后选择相关的代码操作（例如，“Roo Code: 解释代码”）。该操作将在最合乎逻辑的上下文中应用（通常是当前活动的聊天任务，如果存在的话）。
4.  **查看和批准：** Roo Code 将在聊天面板中提出解决方案。查看提议的更改并批准或拒绝它们。

---

## 终端操作

Roo Code 还为终端输出提供类似的操作：

*   **终端：添加到上下文：** 将选定的终端输出添加到您的聊天中
*   **终端：修复命令：** 要求 Roo Code 修复失败的终端命令
*   **终端：解释命令：** 要求 Roo Code 解释终端输出或命令

当您在终端中选择文本并右键单击时，这些操作可用。

---

## 禁用/启用代码操作

您可以通过 VSCode 设置控制代码操作：

### 启用/禁用代码操作
- **设置**: [`roo-cline.enableCodeActions`](vscode://settings/roo-cline.enableCodeActions)
- **默认值**: 启用
- **描述**: 控制 Roo Code 快速修复选项是否出现在编辑器中

要访问此设置：
1. 打开 VSCode 设置（`Ctrl/Cmd + ,`）
2. 搜索“enableCodeActions”
3. 切换复选框以启用或禁用

---

## 自定义代码操作提示

您可以通过修改**提示**选项卡中的“支持提示”来自定义每个代码操作使用的提示。这允许您微调给 AI 模型的指令，并根据您的特定需求定制响应。

1.  **打开提示选项卡：** 单击 Roo Code 顶部菜单栏中的 <Codicon name="notebook" /> 图标。
2. **找到“支持提示”：** 您将看到支持提示，包括“增强提示”、“解释代码”、“改进代码”和“修复代码”。
3. **编辑提示：** 修改您想要自定义的提示的文本区域中的文本。提示使用格式为 `${placeholder}` 的占位符：
    - `${filePath}` - 当前文件的路径
    - `${selectedText}` - 当前选定的文本
    - `${diagnostics}` - 任何错误或警告消息（用于修复代码）- 有关详细信息，请参见[诊断集成](/features/diagnostics-integration)
4. **单击“完成”：** 保存您的更改。

### 示例提示模板
```
请解释以下来自 ${filePath} 的代码：

${selectedText}
```

通过使用 Roo Code 的代码操作，您可以直接在编码工作流程中快速获得 AI 驱动的帮助。这可以节省您的时间并帮助您编写更好的代码。

---

## 相关功能

- [诊断集成](/features/diagnostics-integration) - 了解 Roo Code 如何与 VSCode 的问题面板集成
- [上下文提及](/basic-usage/context-mentions) - 发现其他向 Roo Code 提供上下文的方法
